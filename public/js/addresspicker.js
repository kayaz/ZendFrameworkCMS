(function(e,t){e.widget("ui.addresspicker",{options:{appendAddressString:"",draggableMarker:true,regionBias:null,componentsFilter:"",updateCallback:null,reverseGeocode:false,autocomplete:"default",mapOptions:{zoom:5,center:new google.maps.LatLng(46,2),scrollwheel:false,mapTypeId:google.maps.MapTypeId.ROADMAP},elements:{map:false,lat:false,lng:false,street_number:false,route:false,locality:false,administrative_area_level_2:false,administrative_area_level_1:false,country:false,postal_code:false,type:false},autocomplete:""},marker:function(){return this.gmarker},map:function(){return this.gmap},updatePosition:function(){this._updatePosition(this.gmarker.getPosition())},reloadPosition:function(){this.gmarker.setVisible(true);this.gmarker.setPosition(new google.maps.LatLng(this.lat.val,this.lng.val));this.gmap.setCenter(this.gmarker.getPosition())},selected:function(){return this.selectedResult},_mapped:{},_create:function(){var t=this;this.geocoder={geocode:function(e,t){jQuery.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?"+jQuery.param(e)+"&sensor=false",type:"GET",success:function(e){t(e.results,e.status)}})}};if(this.options.autocomplete==="bootstrap"){this.element.typeahead({source:function(e,n){t._mapped={};var r=function(e){var r=[];for(var i=0;i<e.length;i++){t._mapped[e[i].label]=e[i];r.push(e[i].label)}n(r)};var i={term:e};t._geocode(i,r)},updater:function(e){var n={item:t._mapped[e]};t._focusAddress(null,n);t._selectAddress(null,n);return e}})}else{this.element.autocomplete(e.extend({source:e.proxy(this._geocode,this),focus:e.proxy(this._focusAddress,this),select:e.proxy(this._selectAddress,this)}),this.options.autocomplete)}this.lat=e(this.options.elements.lat);this.lng=e(this.options.elements.lng);this.street_number=e(this.options.elements.street_number);this.route=e(this.options.elements.route);this.locality=e(this.options.elements.locality);this.administrative_area_level_2=e(this.options.elements.administrative_area_level_2);this.administrative_area_level_1=e(this.options.elements.administrative_area_level_1);this.country=e(this.options.elements.country);this.postal_code=e(this.options.elements.postal_code);this.type=e(this.options.elements.type);if(this.options.elements.map){this.mapElement=e(this.options.elements.map);this._initMap()}},_initMap:function(){if(this.lat&&this.lat.val()){this.options.mapOptions.center=new google.maps.LatLng(this.lat.val(),this.lng.val())}this.gmap=new google.maps.Map(this.mapElement[0],this.options.mapOptions);this.gmarker=new google.maps.Marker({position:this.options.mapOptions.center,map:this.gmap,draggable:this.options.draggableMarker});google.maps.event.addListener(this.gmarker,"dragend",e.proxy(this._markerMoved,this));this.gmarker.setVisible(false)},_updatePosition:function(e){if(this.lat){this.lat.val(e.lat())}if(this.lng){this.lng.val(e.lng())}},_addressParts:{street_number:null,route:null,locality:null,administrative_area_level_2:null,administrative_area_level_1:null,country:null,postal_code:null,type:null},_updateAddressParts:function(e){parsedResult=this._parseGeocodeResult(e);for(addressPart in this._addressParts){if(this[addressPart]){this[addressPart].val(parsedResult[addressPart])}}},_updateAddressPartsViaReverseGeocode:function(t){this.geocoder.geocode({latlng:t.lat()+","+t.lng()},e.proxy(function(e,t){if(t==google.maps.GeocoderStatus.OK){this._updateAddressParts(e[0]);this.element.val(e[0].formatted_address);this.selectedResult=e[0];if(this.options.updateCallback){this.options.updateCallback(this.selectedResult,this._parseGeocodeResult(this.selectedResult))}}},this))},_parseGeocodeResult:function(e){var t={lat:e.geometry.location.lat,lng:e.geometry.location.lng};for(var n in this._addressParts){t[n]=this._findInfo(e,n)}t.type=e.types[0];return t},_markerMoved:function(){this._updatePosition(this.gmarker.getPosition());if(this.options.reverseGeocode){this._updateAddressPartsViaReverseGeocode(this.gmarker.getPosition())}},_geocode:function(e,t){var n=e.term,r=this;this.geocoder.geocode({address:n+this.options.appendAddressString,region:this.options.regionBias,components:this.options.componentsFilter},function(e,n){if(n==google.maps.GeocoderStatus.OK&&e){for(var r=0;r<e.length;r++){result=e[r];g=result.geometry;g.location=new google.maps.LatLng(g.location.lat,g.location.lng);g.viewport=new google.maps.LatLngBounds(new google.maps.LatLng(g.viewport.southwest.lat,g.viewport.southwest.lng),new google.maps.LatLng(g.viewport.northeast.lat,g.viewport.northeast.lng));result.label=e[r].formatted_address}}t(e)})},_findInfo:function(e,t){for(var n=0;n<e.address_components.length;n++){var r=e.address_components[n];if(r.types.indexOf(t)!=-1){return r.long_name}}return false},_focusAddress:function(e,t){var n=t.item;if(!n){return}if(this.gmarker){this.gmarker.setPosition(n.geometry.location);this.gmarker.setVisible(true);this.gmap.fitBounds(n.geometry.viewport)}this._updatePosition(n.geometry.location);this._updateAddressParts(n)},_selectAddress:function(e,t){this.selectedResult=t.item;if(this.options.updateCallback){this.options.updateCallback(this.selectedResult,this._parseGeocodeResult(this.selectedResult))}}});e.extend(e.ui.addresspicker,{version:"@VERSION"});if(!Array.indexOf){Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++){if(this[t]==e){return t}}return-1}}})(jQuery);